#!/usr/bin/python


import os,commands


os.system('dialog  --inputbox  "How many datanodes do you need :"   30  30  2>/tmp/countdatanode.txt')
f1=open("/tmp/countdatanode.txt",'r')
c=f1.read()
f1.close()
h=int(c)
#os.system('dialog  --inputbox  "Enter ip of datnode :"   30 30  2>/tmp/datanodeip.txt')
for i in range(0,h-1
	
	#os.system('dialog  --inputbox  "Enter ip of datnode :"   30 30  2>>\n/tmp/datanodeip.txt')
	






def datanode(dip,nip):
	#Data node hdfs-site.xml
	
	d_ip=dip
	n_ip=nip
	f1=open("/root/Desktop/nfiles/ddcore.py",'w+')
	f1.write("""#!/usr/bin/python2
f=open("/etc/hadoop/core-site.xml",'w')
f.write('''<?xml version="1.0"?>
<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>

<!-- Put site-specific property overrides in this file. -->

<configuration>
<property>
<name>fs.default.name</name>
<value>hdfs://"""+n_ip+""":9001</value>
</property>
</configuration>''')
f.close()
	""")
	f1.close()
	

	#Data node core-site.xml 

	f2=open("/root/Desktop/nfiles/ddhdfs.py",'w+')
	f2.write("""#!/usr/bin/python2
f=open("/etc/hadoop/hdfs-site.xml",'w')
f.write('''<?xml version="1.0"?>
<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>

<!-- Put site-specific property overrides in this file. -->

<configuration>
<property>
<name>dfs.data.dir</name>
<value>/datanode1</value>
</property>
</configuration>''')
f.close()
	""")
	f2.close()



	#Starting Data node



	os.system("sshpass -p redhat scp {/root/Desktop/nfiles/ddhdfs.py,/root/Desktop/nfiles/ddcore.py} %s:/root/Desktop" %d_ip)
	os.system("sshpass -p redhat ssh %s python /root/Desktop/ddhdfs.py" %d_ip)
	os.system("sshpass -p redhat ssh %s python /root/Desktop/ddcore.py" %d_ip)
	os.system("sshpass -p redhat ssh %s hadoop-daemon.sh start datanode" %d_ip )
	os.system("sshpass -p redhat ssh %s /usr/java/jdk1.7.0_51/bin/jps" %d_ip )






def tasktracker(dip,jip):
	#tasktracker mapred-site.xml
	t_ip=dip
	j_ip=jip


	
	

	f1=open("/root/Desktop/nfiles/ttmapred.py",'w+')
	f1.write("""#!/usr/bin/python2
f=open("/etc/hadoop/mapred-site.xml",'w')
f.write('''<?xml version="1.0"?>
<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>

<!-- Put site-specific property overrides in this file. -->

<configuration>
<property>
<name>mapred.job.tracker</name>
<value>"""+j_ip+""":9002</value>
</property>
</configuration>''')
f.close()
	""")
	f1.close()


	#Starting tasktracker

	
	os.system("sshpass -p redhat scp /root/Desktop/nfiles/ttmapred.py %s:/root/Desktop" %j_ip)
	os.system("sshpass -p redhat ssh %s python /root/Desktop/ttmapred.py" %t_ip)
	os.system("sshpass -p redhat ssh %s hadoop-daemon.sh start tasktracker" %t_ip )
	os.system("sshpass -p redhat ssh %s /usr/java/jdk1.7.0_51/bin/jps" %t_ip )
		


f1=open("/tmp/countdatanode.txt",'r')
c=f1.read()
f1.close()
h=int(c)
f1=open("/tmp/datanodeip.txt",'r')
for i in range(0,h):
	f1=open("/tmp/datanodeip.txt",'r')
	dip=f1.read()
	f2=open("/tmp/namenode.txt",'r')
	nip=f1.read()
	f2.close()
	f3=open("/tmp/jobtracker.txt",'r')
	jip=f1.read()
	f3.close()
	datanode(dip,nip)
	tasktracker(dip,jip)
f1.close	

	
